name: app
type: dnx

relationships:
    database: "mysqldb:mysql"

web:
    commands:
        start: 'ASPNETCORE_URLS="$SERVER_URL" .global/shared/Microsoft.NETCore.App/1.1.2/dotnet WebApplication1.dll'
    locations:
    "/":
      passthru: true
      root: "wwwroot"
      allow: true

hooks:
    build: |
        mkdir src
        mv * src
        cd src
        wget -qO- https://download.microsoft.com/download/E/7/8/E782433E-7737-4E6C-BFBF-290A0A81C3D7/dotnet-dev-debian-x64.1.0.4.tar.gz | tar xz
        ./dotnet restore
        ./dotnet publish -c Release
        cd ..
        mv src/WebApplication1/bin/Release/netcoreapp1.1/publish/*.* .
        mv src/shared .global
        mv src/WebApplication1/wwwroot .
        rm -rf src

disk: 256

mounts:
    "/storage": "shared:files/storage"
